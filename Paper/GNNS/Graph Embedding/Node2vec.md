Node2vec其实是对于DeepWalk中第2)步，随机游走方式的调整，以学习到图结构的同质性和结构性信息。这里：  



1）同质性是指相邻两节点之间应该具有较高的相似度；   



2）结构性是指邻居结构相似的两节点之间应该具有较高的相似度，即使这两节点之间没有路径连接   



如下图，u与s1,s2,s3,s4之间在同质性上应该具有较高的相似度，而u与s6在结构性上应该具有较高相似度

![](https://cdn.jsdelivr.net/gh/Zhangxin98/Note@main/img/202110091052682.jpeg)

那如何游走才能提现同质性和结构性呢，这其实可以利用我们常见的图搜索算法，深度优先搜索(DFS)和广度优先搜索(BFS):  



1)DFS:深度优先搜索，在相俩节点间游走，倾向于获取同质性信息；  



2)BFS:广度优先搜索，优先获取节点周围邻居序列，倾向于获取结构性信息；   



具体的游走方式如下 

![](https://cdn.jsdelivr.net/gh/Zhangxin98/Note@main/img/202110091053771.jpg)



已知，当前序列的最后两节点为[t,v]，即最后一步游走为t->v，那么接下的游走方式满足如下公式：  

![](https://cdn.jsdelivr.net/gh/Zhangxin98/Note@main/img/202110091053257.jpg)

下面直观解释一下这三种情况：  



\>(1) $d_{tx}=0$，表示$t$节点与$x$节点距离为0，所以它们是同一节点，言外之意是说从$v$节点又跳回了前节点$t$，它的跳转概率定义为$\frac{1}{p}$  

\>(2) $d_{tx}=1$，表示既与$t$相连，又与$v$相连的节点，如图中的$x_1$，它的跳转概率定义为1  

\>(3) $d_{tx}=2$，即图中的$x_2,x_3$节点，它们的跳转概率被定义为$\frac{1}{q}$  



注意，上面的“概率”都未归一化，最终需要进行归一化操作，另外node2vec还需要考虑边的权重$w_{vx}$，所以它实际是对$\pi_{vx}=\alpha_{pq}(t,x)\cdot w_{vx}$进行归一化，下面对超参数$p,q$进行讨论；  



\> 对于p：如果$p>max(q,1)$,那么采样倾向于不会往回走，而如何$p<min(q,1)$，采样倾向于返回上一个节点，在初始点周围游走  



\> 对于q: 如果$q>1$，采样点倾向于在起始点周围游走做BFS采样，而如果$q<1$，倾向于远离起始点，做DFS采样  